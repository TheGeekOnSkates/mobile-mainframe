<!doctype html>
<html lang="en">
<head>
	<title>Mobile Mainframe 1.0</title>
</head>
<body>
	<textarea autofocus spellcheck="false" cols="80" rows="24" aria-label="output" id="dummy">ENTER ADDRESS:  


</textarea>
<script>

var url = "", token = "", line = "";

async function send(input) {
	try {
		var r = await fetch(url, {
			method: 'POST',
			headers:{'Content-Type':'application/x-www-form-urlencoded'},
			body: "i=" + encodeURIComponent(input) + "&&t=" + token
		});
		r = await r.text();
		dummy.value += r + "\n";
	} catch(wtf) {
		dummy.value += wtf + "\n";
	}
}

setInterval(async function() {
	dummy.selectionStart = dummy.selectionEnd = dummy.value.length;
	dummy.scrollTop = dummy.scrollHeight;
	if (!line) return;
	if (!url) {
		url = line;
		console.log(url);
		var r = await fetch(url);
		token = await r.text();
		send("::welcome::");
		return;
	}
	if (line == "exit") {
		send("::end-session::");
		dummy.value += "Connection closed.\n\nENTER ADDRESS:\n";
		url = "";
		line = "";
		return;
	}
	send(line);
	line = "";
}, 100);

dummy.addEventListener("keydown", function(e) {
	if (e.key == "Enter" || e.which == 13) {
		var lines = dummy.value.split("\n");
		console.log(lines);
		line = lines[lines.length - 1];
		console.log("line = " + line);
	}
});
</script>
</body>
</html>
