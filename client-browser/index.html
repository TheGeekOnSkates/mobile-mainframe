<!doctype html>
<html lang="en">
<head>
	<title>Mobile Mainframe 1.0</title>
</head>
<body>
<textarea cols="80" rows="24" aria-label="output" id="dummy"></textarea>
<form id="form">
<input type="text" autofocus autocomplete="off" aria-label="input" id="box"/>
<input type="submit" value="Send"/>
</form>
<script>

var url = "", token = "";
async function send(input) {
	var r = await fetch(url, {
		method: 'POST',
		headers:{'Content-Type':'application/x-www-form-urlencoded'},
		body: "i=" + encodeURIComponent(input) + "&&t=" + token
	});
	r = await r.text();
	dummy.value += r;
}

while(!url) url = prompt("Enter address:");
(async function() {
	var r = await fetch(url);
	token = await r.text();
	send("::welcome::");
})();

form.onsubmit = function(e) {
	e.preventDefault();
	if (box.value == "exit") {
		send("::end-session::");
		alert("Connection closed.");
		location.reload();
		return;
	}
	dummy.value += "> " + box.value + "\n";
	send(box.value);
	box.value = "";
};
</script>
</body>
</body>
</html>
